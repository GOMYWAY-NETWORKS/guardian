<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Guardian by Mashape</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Guardian</h1>
        <p>Remove the OAuth dance with one request.</p>

        <p class="view"><a href="https://github.com/Mashape/guardian">View the Project on GitHub <small>Mashape/guardian</small></a></p>


        <ul>
          <li><a href="https://github.com/Mashape/guardian/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/Mashape/guardian/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/Mashape/guardian">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="guardian" class="anchor" href="#guardian" aria-hidden="true"><span class="octicon octicon-link"></span></a>Guardian</h1>

<p>Avoid dealing with OAuth logic in your code, and spend more time creating your product. Guardian reduces the OAuth footprint in your code to a <em>single</em> request.</p>

<p>Built with modularity in mind, Guardian leverages plugins to handle OAuth flows, should you encounter a flow that Guardian doesn't handle, create a small flow plugin to do so and carry on. Guardian comes with <strong>5</strong> pre-made plugins that cover <strong>99%</strong> of OAuth services.</p>

<p>Not to mention, Guardian is perfect for <strong>both</strong> production <em>and</em> testing. Services like Github require you to enter a single callback url, this is fine when in production, but move to another environment and soon you'll have conflicts, require building complex services to juggle environment scenarios and more. Guardian is centralized and easily configurable to allow multiple environments giving you the flexibility you need.</p>

<p>Created with love by <a href="http://github.com/nijikokun">nijikokun</a> at <a href="http://mashape.com">http://mashape.com</a></p>

<h2>
<a id="requirements" class="anchor" href="#requirements" aria-hidden="true"><span class="octicon octicon-link"></span></a>Requirements</h2>

<ul>
<li><a href="http://nodejs.org/download/">Node.js</a></li>
<li><a href="http://redis.io/topics/quickstart">Redis</a></li>
</ul>

<h2>
<a id="install" class="anchor" href="#install" aria-hidden="true"><span class="octicon octicon-link"></span></a>Install</h2>

<ol>
<li>Install <a href="http://redis.io/topics/quickstart">Redis</a>
</li>
<li>
<p>Globally install Guardian</p>

<div class="highlight highlight-bash"><pre>$ npm install -g guardian</pre></div>
</li>
</ol>

<h2>
<a id="starting" class="anchor" href="#starting" aria-hidden="true"><span class="octicon octicon-link"></span></a>Starting</h2>

<div class="highlight highlight-bash"><pre>$ guardian</pre></div>

<h3>
<a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuration</h3>

<p>Configuration files are loaded from the current working directory of where you call Guardian. Should no configuration argument be passed <code>./config/default.js</code> is loaded.</p>

<div class="highlight highlight-bash"><pre>$ guardian -c <span class="pl-k">&lt;</span>relative configuration path<span class="pl-k">&gt;</span></pre></div>

<p><strong>Options</strong></p>

<table>
<thead>
<tr>
<th>Property</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>host</code></td>
<td><code>localhost:3000</code></td>
<td>Public IP or Domain Name, used to generate the callback uri.</td>
</tr>
<tr>
<td><code>protocol</code></td>
<td><code>http</code></td>
<td>Host Protocol</td>
</tr>
<tr>
<td><code>port</code></td>
<td><code>3000</code></td>
<td>Server Port</td>
</tr>
<tr>
<td><code>workers</code></td>
<td><code>require('os').cpus().length</code></td>
<td>Number of forked instances of the Guardian server to run, suggested amount is CPU count.</td>
</tr>
<tr>
<td><code>pid.dir</code></td>
<td><code>./</code></td>
<td>
<code>.guardian.pid</code> file output directory, for production we suggest placing this under the <code>/home/&lt;user&gt;/</code> directory, requires trailing slash.</td>
</tr>
<tr>
<td><code>redis.host</code></td>
<td><code>127.0.0.1</code></td>
<td>Host redis can be reached on</td>
</tr>
<tr>
<td><code>redis.port</code></td>
<td><code>6379</code></td>
<td>Port redis is current running on</td>
</tr>
<tr>
<td><code>redis.pass</code></td>
<td></td>
<td>Redis password</td>
</tr>
<tr>
<td><code>redis.expire</code></td>
<td><code>60</code></td>
<td>Guardian store expiration timeout in Seconds</td>
</tr>
<tr>
<td><code>cookie.secret</code></td>
<td></td>
<td>Guardian cookie secret</td>
</tr>
<tr>
<td><code>session.secret</code></td>
<td></td>
<td>Guardian session secret</td>
</tr>
</tbody>
</table>

<h2>
<a id="routes" class="anchor" href="#routes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Routes</h2>

<p>Guardian HTTP API for handling authentication flows.</p>

<h3>
<a id="storage" class="anchor" href="#storage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Storage</h3>

<pre lang="http"><code>POST /store
</code></pre>

<p>Stores information given, returns a session hash to be used later on. 
Information stored lives for <code>60</code> seconds by default, change <code>redis.expire</code> to alter timeout duration.</p>

<h4>
<a id="parameters" class="anchor" href="#parameters" aria-hidden="true"><span class="octicon octicon-link"></span></a>Parameters</h4>

<h6>
<a id="oauth-2" class="anchor" href="#oauth-2" aria-hidden="true"><span class="octicon octicon-link"></span></a>OAuth 2</h6>

<p>Details specific to OAuth2</p>

<table>
<thead>
<tr>
<th>Key</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>client_id</code></td>
<td></td>
<td>OAuth Client Identifier</td>
</tr>
<tr>
<td><code>client_secret</code></td>
<td></td>
<td>OAuth Client Secret</td>
</tr>
<tr>
<td><code>grant_type</code></td>
<td></td>
<td>Common values (dependant on OAuth flow used): <code>authorization_code</code>, <code>client_credentials</code>, <code>password</code>, <code>refresh_token</code>, ...</td>
</tr>
<tr>
<td><code>access_name</code></td>
<td><code>access_token</code></td>
<td>Access token name</td>
</tr>
<tr>
<td><code>authorize_method</code></td>
<td><code>Bearer</code></td>
<td>
<em>Optional</em> - Authorization header method, some possible values: <code>Bearer</code>, <code>OAuth</code>, <code>Digest</code>
</td>
</tr>
<tr>
<td><code>state</code></td>
<td></td>
<td>State identifier, depends on provider</td>
</tr>
<tr>
<td><code>scope</code></td>
<td></td>
<td>OAuth request scopes, depends on provider</td>
</tr>
</tbody>
</table>

<h6>
<a id="oauth-1" class="anchor" href="#oauth-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>OAuth 1</h6>

<p>Details specific to OAuth 1.0a</p>

<table>
<thead>
<tr>
<th>Key</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>consumer_key</code></td>
<td></td>
<td>OAuth Consumer Identifier</td>
</tr>
<tr>
<td><code>consumer_secret</code></td>
<td></td>
<td>OAuth Consumer Secret</td>
</tr>
<tr>
<td><code>signature_method</code></td>
<td><code>HMAC-SHA1</code></td>
<td>OAuth Header encryption method, possible values: <code>PLAINTEXT</code>, <code>HMAC-SHA1</code>, <code>RSA-SHA1</code>
</td>
</tr>
<tr>
<td><code>oauth_token</code></td>
<td></td>
<td>
<em>Optional;</em> OAuth Token. Used in OAuth 1.0a 1-Legged (Resource request)</td>
</tr>
</tbody>
</table>

<h6>
<a id="plugin-required" class="anchor" href="#plugin-required" aria-hidden="true"><span class="octicon octicon-link"></span></a>Plugin (<em>required</em>)</h6>

<p>Parameters combined to create the <a href="https://github.com/Mashape/guardian/blob/master/lib/core.js#L100-L118">plugin file name</a>.</p>

<table>
<thead>
<tr>
<th>Key</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>auth_type</code></td>
<td><code>oauth</code></td>
<td>Authentication type, <code>a-z</code> characters accepted only.</td>
</tr>
<tr>
<td><code>auth_flow</code></td>
<td></td>
<td>
<em>Optional;</em> Authentication flow, would be <code>echo</code>, <code>owner_resources</code>, etc... <code>a-z</code> characters accepted only.</td>
</tr>
<tr>
<td><code>auth_version</code></td>
<td></td>
<td>
<em>Optional;</em> Authentication version, for OAuth 2, we would use <code>2</code>, numeric only.</td>
</tr>
<tr>
<td><code>auth_leg</code></td>
<td></td>
<td>
<em>Optional;</em> Authentication leg, for OAuth 2 (3-legged), we would use <code>3</code>, numeric only.</td>
</tr>
</tbody>
</table>

<p>For example, <a href="/plugins/oauth_2_3-legged.js"><code>plugins/oauth_2_3-legged.js</code></a> (OAuth 2, 3-legged), would look like:</p>

<div class="highlight highlight-js"><pre>{
  ...
  auth_type<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">'</span>oauth<span class="pl-pds">'</span></span>,
  auth_version<span class="pl-k">:</span> <span class="pl-c1">2</span>,
  auth_leg<span class="pl-k">:</span> <span class="pl-c1">3</span>
  ...
}</pre></div>

<h6>
<a id="general" class="anchor" href="#general" aria-hidden="true"><span class="octicon octicon-link"></span></a>General</h6>

<table>
<thead>
<tr>
<th>Key</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>request_url</code></td>
<td>Authentication Request Url, e.g. <code>https://github.com/login/oauth/request_url</code>
</td>
</tr>
<tr>
<td><code>access_url</code></td>
<td>Authentication Access Url, e.g. <code>https://github.com/login/oauth/access_token</code>
</td>
</tr>
<tr>
<td><code>authorize_url</code></td>
<td>Authentication Authorization Url, e.g. <code>https://github.com/login/oauth/authorize</code>
</td>
</tr>
<tr>
<td><code>callback</code></td>
<td>Authentication Callback URL on requesting server to obtain <code>access_token</code> and <code>access_secret</code>, e.g. <code>http://localhost:3001/callback</code>
</td>
</tr>
</tbody>
</table>

<h4>
<a id="example" class="anchor" href="#example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example</h4>

<p>Request:</p>

<div class="highlight highlight-js"><pre><span class="pl-k">&gt;</span> POST https<span class="pl-k">:</span><span class="pl-c">//&lt;guardian-host&gt;/store</span>

{
  client_id<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">'</span>Client Identifier<span class="pl-pds">'</span></span>,
  client_secret<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">'</span>Client Secret<span class="pl-pds">'</span></span>,
  access_name<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">'</span>access_token<span class="pl-pds">'</span></span>,
  authorize_url<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">'</span>https://github.com/login/oauth/authorize<span class="pl-pds">'</span></span>,
  access_url<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">'</span>https://github.com/login/oauth/access_token<span class="pl-pds">'</span></span>,
  request_url<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">'</span>https://github.com/login/oauth/request_url<span class="pl-pds">'</span></span>,
  auth_type<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>oauth<span class="pl-pds">"</span></span>,
  auth_version<span class="pl-k">:</span> <span class="pl-c1">2</span>,
  auth_leg<span class="pl-k">:</span> <span class="pl-c1">3</span>,
  callback<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>http://localhost:3001/callback<span class="pl-pds">"</span></span>
}</pre></div>

<p>Response:</p>

<div class="highlight highlight-js"><pre><span class="pl-k">&lt;</span> <span class="pl-c1">200</span> OK
<span class="pl-k">&lt;</span> Header<span class="pl-k">:</span> Content<span class="pl-k">-</span>Type<span class="pl-k">=</span>application/json

{ 
  hash<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">'</span>&lt;guardian session hash&gt;<span class="pl-pds">'</span></span>, 
  url<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">'</span>https://&lt;guardian-host&gt;/start?hash=&lt;guardian session hash&gt;<span class="pl-pds">'</span></span>
}</pre></div>

<h3>
<a id="hash-check" class="anchor" href="#hash-check" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hash Check</h3>

<pre lang="http"><code>GET /hash-check
</code></pre>

<p>Allows you to preview / verify your stored information in-case of error or malformed response.</p>

<p>Once again, stored information by default lasts only <code>10</code> seconds.</p>

<h4>
<a id="parameters-1" class="anchor" href="#parameters-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Parameters</h4>

<table>
<thead>
<tr>
<th>Key</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>hash</code></td>
<td>Guardian session hash obtained from <a href="#storage">Storage</a>
</td>
</tr>
</tbody>
</table>

<h3>
<a id="start" class="anchor" href="#start" aria-hidden="true"><span class="octicon octicon-link"></span></a>Start</h3>

<pre lang="http"><code>GET /start?hash=&lt;guardian store hash&gt;
</code></pre>

<p>Redirecting the client to this route starts the Guardian authentication steps, Each steps are done with <code>302</code> response code and should be followed.</p>

<h4>
<a id="parameters-2" class="anchor" href="#parameters-2" aria-hidden="true"><span class="octicon octicon-link"></span></a>Parameters</h4>

<table>
<thead>
<tr>
<th>Key</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>hash</code></td>
<td>Guardian session hash obtained from <a href="#storage">Storage</a>
</td>
</tr>
</tbody>
</table>

<h6>
<a id="oauth-10a" class="anchor" href="#oauth-10a" aria-hidden="true"><span class="octicon octicon-link"></span></a>OAuth 1.0a</h6>

<p>Used in the OAuth 1.0a Signature Process for 1-Legged requests. <a href="https://github.com/Mashape/guardian/blob/master/tests/factual.js#L46">Example</a>.</p>

<table>
<thead>
<tr>
<th>Key</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>url</code></td>
<td>Request URL, query parameters will be parsed from here as well as parameters property.</td>
</tr>
<tr>
<td><code>method</code></td>
<td>Request Method.</td>
</tr>
<tr>
<td><code>body</code></td>
<td>Request Payload / Body.</td>
</tr>
<tr>
<td><code>parameters</code></td>
<td>Request Parameters for Request Signatures or etc...</td>
</tr>
</tbody>
</table>

<h2>
<a id="tests--examples" class="anchor" href="#tests--examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tests &amp; Examples</h2>

<p>Each test in the test folder is based on an API or feature of guardian rather than TDD or BDD based tests, we verify successful authentication and we can retrieve information while authenticated from the API using tokens Guardian provides.</p>

<p>In this manner the tests also serve as very good <a href="tests/">examples</a> of how to use Guardian.</p>

<p>To run one of these test you'll need to have keys ready and run the following command:</p>

<div class="highlight highlight-bash"><pre>$ node tests/<span class="pl-k">&lt;</span>provider name<span class="pl-k">&gt;</span>.js \
  -k {Your Consumer/Client Key/Id} <span class="pl-cce">\ </span>
  -s {Your Consumer/Client Secret} \
  -h {host, ie: localhost or domain}</pre></div>

<p>Then visit the server running on port <code>3001</code> to start the authentication process.</p>

<p>You will recieve a response with the headers sent, and the returned response from the API, Guardian must be running locally on port <code>3000</code> for these examples to work correctly.</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/Mashape">Mashape</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>