{"name":"Guardian","tagline":"Remove the OAuth dance with one request.","body":"# Guardian\r\n\r\nAvoid dealing with OAuth logic in your code, and spend more time creating your product. Guardian reduces the OAuth footprint in your code to a *single* request.\r\n\r\nBuilt with modularity in mind, Guardian leverages plugins to handle OAuth flows, should you encounter a flow that Guardian doesn't handle, create a small flow plugin to do so and carry on. Guardian comes with **5** pre-made plugins that cover **99%** of OAuth services.\r\n\r\nNot to mention, Guardian is perfect for **both** production *and* testing. Services like Github require you to enter a single callback url, this is fine when in production, but move to another environment and soon you'll have conflicts, require building complex services to juggle environment scenarios and more. Guardian is centralized and easily configurable to allow multiple environments giving you the flexibility you need.\r\n\r\nCreated with love by [nijikokun](http://github.com/nijikokun) at http://mashape.com\r\n\r\n## Requirements\r\n\r\n- [Node.js](http://nodejs.org/download/)\r\n- [Redis](http://redis.io/topics/quickstart)\r\n\r\n## Install\r\n\r\n1. Install [Redis](http://redis.io/topics/quickstart)\r\n2. Globally install Guardian\r\n\r\n   ```bash\r\n   $ npm install -g guardian\r\n   ```\r\n\r\n## Starting\r\n\r\n```bash\r\n$ guardian\r\n```\r\n\r\n### Configuration\r\n\r\nConfiguration files are loaded from the current working directory of where you call Guardian. Should no configuration argument be passed `./config/default.js` is loaded.\r\n\r\n```bash\r\n$ guardian -c <relative configuration path>\r\n```\r\n\r\n**Options**\r\n\r\n| Property                    | Default                                  | Description                                                       |\r\n| --------------------------- | ---------------------------------------- | ----------------------------------------------------------------- |\r\n| `host`                      | `localhost:3000`                         | Public IP or Domain Name, used to generate the callback uri.      |\r\n| `protocol`                  | `http`                                   | Host Protocol                                                     |\r\n| `port`                      | `3000`                                   | Server Port                                                       |\r\n| `workers`                   | `require('os').cpus().length`            | Number of forked instances of the Guardian server to run, suggested amount is CPU count. |\r\n| `pid.dir`                   | `./`                                     | `.guardian.pid` file output directory, for production we suggest placing this under the `/home/<user>/` directory, requires trailing slash. |\r\n| `redis.host`                | `127.0.0.1`                              | Host redis can be reached on                                      |    \r\n| `redis.port`                | `6379`                                   | Port redis is current running on                                  |    \r\n| `redis.pass`                |                                          | Redis password                                                    |\r\n| `redis.expire`              | `60`                                     | Guardian store expiration timeout in Seconds                      |\r\n| `cookie.secret`             |                                          | Guardian cookie secret                                            |\r\n| `session.secret`            |                                          | Guardian session secret                                           |\r\n\r\n## Routes\r\n\r\nGuardian HTTP API for handling authentication flows.\r\n\r\n### Storage\r\n\r\n```http\r\nPOST /store\r\n```\r\n\r\nStores information given, returns a session hash to be used later on. \r\nInformation stored lives for `60` seconds by default, change `redis.expire` to alter timeout duration.\r\n\r\n#### Parameters\r\n\r\n###### OAuth 2\r\n\r\nDetails specific to OAuth2\r\n\r\n\r\n| Key                        | Default                                  | Description                                                       |\r\n| -------------------------- | ---------------------------------------- | ----------------------------------------------------------------- |\r\n| `client_id`                |                                          | OAuth Client Identifier                                           |\r\n| `client_secret`            |                                          | OAuth Client Secret                                               |\r\n| `grant_type`               |                                          | Common values (dependant on OAuth flow used): `authorization_code`, `client_credentials`, `password`, `refresh_token`, ... |\r\n| `access_name`              | `access_token`                           | Access token name                                                 |\r\n| `authorize_method`         | `Bearer`                                 | *Optional* - Authorization header method, some possible values: `Bearer`, `OAuth`, `Digest` |\r\n| `state`                    |                                          | State identifier, depends on provider                             |\r\n| `scope`                    |                                          | OAuth request scopes, depends on provider                         |\r\n\r\n###### OAuth 1\r\n\r\nDetails specific to OAuth 1.0a\r\n\r\n| Key                        | Default                                  | Description                                                       |\r\n| -------------------------- | ---------------------------------------- | ----------------------------------------------------------------- |\r\n| `consumer_key`             |                                          | OAuth Consumer Identifier                                         |\r\n| `consumer_secret`          |                                          | OAuth Consumer Secret                                             |\r\n| `signature_method`         | `HMAC-SHA1`                              | OAuth Header encryption method, possible values: `PLAINTEXT`, `HMAC-SHA1`, `RSA-SHA1` |\r\n| `oauth_token`              |                                          | *Optional;* OAuth Token. Used in OAuth 1.0a 1-Legged (Resource request) |\r\n\r\n###### Plugin (*required*)\r\n\r\nParameters combined to create the [plugin file name](https://github.com/Mashape/guardian/blob/master/lib/core.js#L100-L118).\r\n\r\n| Key                        | Default                                  | Description                                                       |\r\n| -------------------------- | ---------------------------------------- | ----------------------------------------------------------------- |\r\n| `auth_type`                | `oauth`                                  | Authentication type, `a-z` characters accepted only.              |\r\n| `auth_flow`                |                                          | *Optional;* Authentication flow, would be `echo`, `owner_resources`, etc... `a-z` characters accepted only. |\r\n| `auth_version`             |                                          | *Optional;* Authentication version, for OAuth 2, we would use `2`, numeric only. |\r\n| `auth_leg`                 |                                          | *Optional;* Authentication leg, for OAuth 2 (3-legged), we would use `3`, numeric only. |\r\n\r\nFor example, [`plugins/oauth_2_3-legged.js`](/plugins/oauth_2_3-legged.js) (OAuth 2, 3-legged), would look like:\r\n\r\n```js\r\n{\r\n  ...\r\n  auth_type: 'oauth',\r\n  auth_version: 2,\r\n  auth_leg: 3\r\n  ...\r\n}\r\n```\r\n\r\n###### General\r\n\r\n| Key                        | Description                                                       |\r\n| -------------------------- | ----------------------------------------------------------------- |\r\n| `request_url`              | Authentication Request Url, e.g. `https://github.com/login/oauth/request_url` |\r\n| `access_url`               | Authentication Access Url, e.g. `https://github.com/login/oauth/access_token` |\r\n| `authorize_url`            | Authentication Authorization Url, e.g. `https://github.com/login/oauth/authorize` |\r\n| `callback`                 | Authentication Callback URL on requesting server to obtain `access_token` and `access_secret`, e.g. `http://localhost:3001/callback` |\r\n\r\n#### Example\r\n\r\nRequest:\r\n\r\n```js\r\n> POST https://<guardian-host>/store\r\n\r\n{\r\n  client_id: 'Client Identifier',\r\n  client_secret: 'Client Secret',\r\n  access_name: 'access_token',\r\n  authorize_url: 'https://github.com/login/oauth/authorize',\r\n  access_url: 'https://github.com/login/oauth/access_token',\r\n  request_url: 'https://github.com/login/oauth/request_url',\r\n  auth_type: \"oauth\",\r\n  auth_version: 2,\r\n  auth_leg: 3,\r\n  callback: \"http://localhost:3001/callback\"\r\n}\r\n```\r\n\r\nResponse:\r\n\r\n```js\r\n< 200 OK\r\n< Header: Content-Type=application/json\r\n\r\n{ \r\n  hash: '<guardian session hash>', \r\n  url: 'https://<guardian-host>/start?hash=<guardian session hash>'\r\n}\r\n```\r\n\r\n### Hash Check\r\n\r\n```http\r\nGET /hash-check\r\n```\r\n\r\nAllows you to preview / verify your stored information in-case of error or malformed response.\r\n\r\nOnce again, stored information by default lasts only `10` seconds.\r\n\r\n#### Parameters\r\n\r\n\r\n| Key                        | Description                                                       |\r\n| -------------------------- | ----------------------------------------------------------------- |\r\n| `hash`                     | Guardian session hash obtained from [Storage](#storage)           |\r\n\r\n### Start\r\n\r\n```http\r\nGET /start?hash=<guardian store hash>\r\n```\r\n\r\nRedirecting the client to this route starts the Guardian authentication steps, Each steps are done with `302` response code and should be followed.\r\n\r\n#### Parameters\r\n\r\n| Key                        | Description                                                       |\r\n| -------------------------- | ----------------------------------------------------------------- |\r\n| `hash`                     | Guardian session hash obtained from [Storage](#storage)           |\r\n\r\n###### OAuth 1.0a\r\n\r\nUsed in the OAuth 1.0a Signature Process for 1-Legged requests. [Example](https://github.com/Mashape/guardian/blob/master/tests/factual.js#L46).\r\n\r\n\r\n| Key                        | Description                                                       |\r\n| -------------------------- | ----------------------------------------------------------------- |\r\n| `url`                      | Request URL, query parameters will be parsed from here as well as parameters property. |\r\n| `method`                   | Request Method.                                                   |\r\n| `body`                     | Request Payload / Body. |\r\n| `parameters`               | Request Parameters for Request Signatures or etc... |\r\n\r\n## Tests & Examples\r\n\r\nEach test in the test folder is based on an API or feature of guardian rather than TDD or BDD based tests, we verify successful authentication and we can retrieve information while authenticated from the API using tokens Guardian provides.\r\n\r\nIn this manner the tests also serve as very good [examples](tests/) of how to use Guardian.\r\n\r\nTo run one of these test you'll need to have keys ready and run the following command:\r\n\r\n```bash\r\n$ node tests/<provider name>.js \\\r\n  -k {Your Consumer/Client Key/Id} \\ \r\n  -s {Your Consumer/Client Secret} \\\r\n  -h {host, ie: localhost or domain}\r\n```\r\n\r\nThen visit the server running on port `3001` to start the authentication process.\r\n\r\nYou will recieve a response with the headers sent, and the returned response from the API, Guardian must be running locally on port `3000` for these examples to work correctly.\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}